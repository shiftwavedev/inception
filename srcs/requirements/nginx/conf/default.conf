# NGINX Server Configuration
# Custom configuration for Inception project - WordPress with HTTPS

server {
    # Custom: Listen on port 443 with SSL for both IPv4 and IPv6
    listen 443 ssl;
    listen [::]:443 ssl;

    # Custom: TLS protocol versions (modern security standards)
    # TLSv1.2 and TLSv1.3 only - older versions disabled for security
    ssl_protocols TLSv1.2 TLSv1.3;

    # Custom: SSL certificate paths (self-signed, generated at container startup)
    ssl_certificate_key /etc/ssl/certs/selfsigned.key;
    ssl_certificate /etc/ssl/certs/selfsigned.crt;

    # Document root for WordPress installation
    root /var/www/html;

    # Default index files priority order
    index index.php index.html index.htm;

    # Custom: Dynamic server name from environment variable
    # Replaced at runtime by entrypoint.sh using envsubst
    server_name ${LOGIN}.42.fr;

    # Custom: WordPress permalink handling
    # Try file, then directory, then pass to index.php with query string
    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    # Custom: PHP-FPM FastCGI configuration for .php files
    # Forward PHP requests to WordPress container on port 9000
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass wordpress:9000;
    }
}